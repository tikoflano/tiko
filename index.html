<!DOCTYPE html>
<html>
    <head>
        <base href="/tiko/" />
        <title>Juego</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" type="text/css" href="semantic/semantic.min.css"/>
        <link rel="stylesheet" type="text/css" href="css/style.css"/>
        <link rel="stylesheet" type="text/css" href="css/actions.css"/>
        <link rel="stylesheet" type="text/css" href="css/card.css"/>
        <link rel="stylesheet" type="text/css" href="css/die.css"/>
        <link rel="stylesheet" type="text/css" href="css/dice.css"/>
        <link rel="stylesheet" type="text/css" href="css/board.css"/>
        <link rel="stylesheet" type="text/css" href="css/player.css"/>
        <link rel="stylesheet" type="text/css" href="css/messages.css"/>
        <link rel="stylesheet" type="text/css" href="css/figure.css"/>
        <link rel="stylesheet" type="text/css" href="css/player-board.css"/>
        
        <script src="jquery/jquery-3.2.1.min.js"></script>
        <script src="semantic/semantic.min.js"></script>
        <script src="angular-1.6.4/angular.min.js"></script>
        <script src="lodash/lodash.min.js"></script>
        
        <script src="game/app.js"></script>
        <script src="game/controllers/gameController.js"></script>
        <script src="game/services/utils.js"></script>
        <script src="game/factories/card.js"></script>
        <script src="game/factories/board.js"></script>
        <script src="game/factories/player.js"></script>
        <script src="game/factories/deck.js"></script>
        <script src="game/factories/togetherjs.js"></script>
        <script src="game/directives/card.js"></script>
        <script src="game/directives/figure.js"></script>
        <script src="game/directives/playerBoard.js"></script>
        <script src="https://togetherjs.com/togetherjs-min.js"></script>
    </head>
    <body ng-app="game" ng-controller="GameController as ctrl" ng-keypress="ctrl.phase && $event.key == ' ' && ctrl.playPhase()">
        <div id="main" class="ui basic segment" ng-class="{loading: ctrl.loading}">
            <div class="ui middle aligned three column centered grid" ng-if="!ctrl.togetherjs.isRunning() && !ctrl.loading">
                <div class="center aligned column">
                    <button class="ui massive fluid blue button" ng-click="ctrl.newGame()">Crear partida</button>
                </div>
            </div>
            
            <div class="ui grid" ng-if="ctrl.togetherjs.isRunning()">
                <div id="actions" class="center aligned row">
                </div>
                <div id="messages" class="row">
                    <div class="ui icon message" ng-if="ctrl.phase">
                        <i class="icon" 
                           ng-class="{'info circle' : !ctrl.active_player,'hourglass end' : ctrl.active_player && ctrl.active_player != ctrl.local_player, 'video play' : ctrl.active_player == ctrl.local_player}"></i>
                        <div class="content">
                            <div class="header">
                                <span ng-if="!ctrl.active_player">Juego no iniciado</span>
                                <span ng-if="ctrl.active_player && ctrl.active_player != ctrl.local_player">Esperando a {{ctrl.active_player.name}}</span>
                                <span ng-if="ctrl.active_player == ctrl.local_player">Fase actual</span>
                            </div>
                            <p>{{ctrl.phase.text}}</p>
                        </div>
                    </div>
                    <div class="ui icon message" ng-if="ctrl.message" ng-class="ctrl.message.type">
                        <i class="warning circle icon"></i>
                        <div class="content">
                            <div class="header">{{ctrl.message.header}}</div>
                            <p>{{ctrl.message.message}}</p>
                        </div>
                    </div>
                </div>
                <div id="players" class="equal width row">
                    <div class="center aligned column" ng-repeat="player in ctrl.players" >
                        <div class="ui compact segment player" ng-class="{active: player.active, finished: player.finished}">                            
                            <div class="ui horizontal segments" ng-style="{background: player.color}">
                                <div class="ui compact segment">
                                    <span class="ui circular label" ng-class="player.finished ? 'red' : 'black'">{{player.score}}</span>
                                </div>
                                <div class="ui name compact segment">{{player.name}}</div>
                                <div class="ui compact segment">
                                    <i class="circular inverted link grid layout icon" ng-click="ctrl.showBoard(player)"></i>
                                </div>
                            </div>
                            <div class="player-cards">
                                <span class="player-card" ng-repeat="player_card in player.player_cards" ng-style="{'background-color': player.color}"></span>
                                <span ng-hide="player.player_cards.length">-</span>
                            </div>
                            <div class="hand">
                                <div class="ui horizontal segments">
                                    <div class="ui segment" ng-repeat="card in player.hand" >
                                        <card card="card" ng-click="player.active && ctrl.changeActive(card, 'card', $event.currentTarget)" ></card>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <player-board></player-board>
                </div>
                <div id="dice" class="centered row">
                    <div class="ui horizontal segments">
                        <span class="ui die compact segment" ng-repeat="die in ctrl.dice" 
                              ng-class="[die.color, {active: die.active}, die.number ? 'die-'+die.number : 'die-0']" 
                              ng-click="ctrl.changeActive(die, 'die', $event.currentTarget)"></span>
                    </div>
                    <input type="number" ng-model="ctrl.number" ng-if="ctrl.config.debug">
                </div>
                <div class="board centered row">
                    <div class="ui compact segments">
                        <div class="ui horizontal segments" ng-repeat="row in ctrl.board.rows">
                            <div class="ui segment" ng-repeat="card in row" >
                                <card ng-click="ctrl.changeActive(card, 'card', $event.currentTarget)" card="card"></card>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
